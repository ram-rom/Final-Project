#!/usr/bin/env ruby

require 'pry'
require 'optparse'

def load_environment
  lib_dir = "#{File.expand_path(File.dirname(__FILE__))}/../lib"
  Dir["#{lib_dir}/*.rb"].each { |file| require file }
end

def parse_arguments(argv)
  options = {}

  argv << '-h' if argv.empty?
  parser = OptionParser.new do |opts|
    opts.banner = "Usage: ram-rom [command] [options]"

    opts.on_head(<<-HEAD

SYNOPSIS
HEAD
    )
    opts.on('-i', '--install', "Command to install simpleScalar") do
      options[:command] = :install
    end

    opts.on('-c', '--compile', "Command to compile simpleScaler") do
      opts[:command] = :compile
    end

    opts.on_tail(<<-TAIL

DESCRIPTION
  These are the options you can pass to ram-rom. You can only run one command at a time. Some commands have extra options.

  COMMANDS
  --install
    This should only need to be done once or if you want a fresh install.

  --compile
    Run this each time you want to compile simple scalar with your changes.
TAIL
    )
  end

  parser.parse!(argv)

  options
end

def main(argv)
  load_environment

  opts    = parse_arguments(argv)
  command = opts[:command]

  case command
  when :install
      Lib::Installer.new.run
  when :compile
      Lib::Compiler.new.run
  end
end

main(ARGV)  if $0 == __FILE__

